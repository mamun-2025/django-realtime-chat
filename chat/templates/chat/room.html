
<!DOCTYPE html>
<html>
<head>
   <title> Chat Room </title>
</head>
<body>
   <h2 id="room-title">Room: {{ room_name }}</h2>
   <textarea id="chat_log" cols="100" rows="20" readonly style= "background: #f9f9f9; border: 1px solid #ccc; padding: 10px;"></textarea><br><br>
   <input id="chat-message-input" type="text" size="100" placeholder= "Type your message here...."><br><br>
   <input id="chat-message-submit" type="button" value="Send Message">

   {{ room_name|json_script:"room-name" }} 

   <script>
      const roomName = JSON.parse(document.getElementById('room-name').textContent);

      // 1. Establishing WebSocket Connection
      const chatSocket = new WebSocket(
         'ws://' + window.location.host + '/ws/chat/' + roomName + '/'
      );

      // 2. Receiving Messages From Server
      chatSocket.onmessage = function(e){
         const data = JSON.parse(e.data);
         document.querySelector('#chat-log').value += (data.message + '\n');

         // auto scorll to the bottom
         const chatlog = document.querySelector('#chat-log');
         chatlog.scrollTop = chatlog.scrollHeight;
      };

      // 3. Handling Connection Clousers
      chatSocket.onclose = function(e){
         console.error('Chat Socket Closed unexpectedly!');
      };

      document.querySelector('#chat-message-input').focus();
      document.querySelector('#chat-message-input').onkeyup= function(e){
         if (e.keyCode === 13){
            document.querySelector('chat-message-submit').click();
         }
      }

      // 4. Sending messages to Server
      document.querySelector('#chat-message-submit').onclick= function(e){
         const messageInputDom = document.querySelector('#chat-message-input');
         const message = messageInputDom.value;
         if (message.trim() !== ""){
            chatSocket.send(JSON.stringify({
               'message': message
            }));
            messageInputDom.value= ''
         }
      };
   </script>
</body>
</html>

