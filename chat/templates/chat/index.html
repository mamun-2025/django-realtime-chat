

{% extends "chat/base.html" %}
{% block title %}Chat Lobby{% endblock %}

{% block content %}
    <div style="max-width: 600px; margin: 0 auto;">

        <div style="background: #fff; padding: 20px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1); margin-bottom: 30px;">
            <h3>üåê Join a Public Room</h3>
            <div style="display: flex; gap: 10px;">
                <input id="room-name-input" type="text" style="flex-grow: 1; padding: 10px; border: 1px solid #ddd; border-radius: 5px;" placeholder="e.g., sports, coding, gaming">
                <input id="room-name-submit" type="button" value="Enter" style="padding: 10px 20px; background: #2980b9; color: white; border: none, cursor: pointer; border-radius: 5px;">
            </div>
        </div>

        <hr style="border: 0; border-top: 1px solid #eee; margin: 30px 0;">

        <div style= "background: #fff; padding: 20px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);">
            <h3>üë§ Direct Messages</h3>
            <p style= "color: #666; font-size: 0.9em;">
                Click on a user to start a private conversation:
            </p>

            <div id="user-lit" style="display: flex; flex-direction: column; gap: 10px; margin-top: 15px;">
                    {% for user in all_users %}
                        <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px; background: #f8f9fa; border-radius: 8px; border-left: 4px solid #27ae60;">
                            <div>
                            <span style="font-weight: bold; color: #333;">
                                {{ user.username }}
                            </span>
                            
                            <span style="display: block; font-size: 0.75em; color: #888;">
                                Joined: {{ user.date_joined|date:"M Y" }}
                            </span>

                            <span style="display: block; font-size: 0.75em; margin-top: 2px;">
                                {% if user.userprofile.is_online %}
                                    <span style="color: #2ecc71; font-weight: bold;">
                                         <span style="font-size: 1.2em;">‚óè</span> Online
                                    </span>
                                {% else %}
                                    <span style="color: #888;">
                                        Last seen: {{ user.userprofile.last_seen|timesince }} ago
                                    </span>
                                {% endif %}
                            </span>
                        </div>
                        
                        <a href="{% url 'private_chat' user.id %}" 
                            style="text-decoration: none; background: #27ae60; color: white; padding: 6px 15px; border-radius: 20px; font-size: 0.85em;">
                            Chat Now
                        </a>
                    </div>
                {% empty %}
                    <p style="text-align: center; color: #999;">No other users found.</p>
                {% endfor %} </div>
            </div>
        </div>
    </div>

<script>
    document.querySelector('#room-name-input').focus();
    document.querySelector('#room-name-input').onkeyup = function(e) {
        if (e.keyCode === 13) document.querySelector('#room-name-submit').click();
    };
    document.querySelector('#room-name-submit').onclick = function(e) {
        var roomName = document.querySelector('#room-name-input').value;
        if (roomName) window.location.pathname = '/chat/' + roomName + '/';
        else alert("Please enter a room name!");
    };
</script>
{% endblock %}


